# Рейтинг пассажира
Предлагается ввести в функциональность сервиса возможность выставления рейтинга пассажиру водителем.

Гипотеза:
> если дать водителю возможность оценивать пассажира, увеличиться комфорт поездок. Водителям не придётся иметь дело с неприятным пассажиром. А отметки одних водителей будут помогать другим и, возможно, покажут пассажиру, что не стоит вести себя неподобающе в такси.

## Постановка задачи, проработка идеи
Дать возможность водителю выставлять своему пассажиру рейтинг по окончании поездки, а так же отдельно отмечать конфликтных пассажиров и просматривать рейтинг перед принятием поездки.

Решение позволяет избавить водителей от лишнего риска при принятии заказа, избавиться от перевозки конфликтных, недобросовестных или грубых пассажиров.

В связи с этим, предлагается ввести как рейтинг, так и отдельную отметку об особенно неприятном пассажире.

Рейтинг пассажира будет рассчитываться по стандартной формуле с большими весами у последних отзывов за промежуок в 15-20 поездок. Отметка же о неприятном пассажире будет видна всем водителям на протяжении двух дней, а для водителя, поставившего её, на протяжении недели.

Для упрощения выставления оценок, водителю, при окончании поездки, будет демонстрироваться экран с уже выставленными пятью звёздами. Ему останется лишь подтвердить оценку, либо, при необходимости, внести изменения. Это в какой-то мере позволит избежать выставления случайных оценок с целью быстрее выйти из Pop-Up окна.

Рейтинг не будет влиять ни на какие параметры пассажира, а будет использоваться водителями для субъективной оценки и самостоятельном принятии решения. Дело в том, что если менять какие-либо существенные параметры у пассажира в связи с рейтингом, например стоимость проезда, которая будет немного выше у пассажиров с плохим рейтингом, то все водители просто начнут ставить низкие оценки для увеличения стоимости проездов.

Пассажиры также смогут видеть свой рейтинг, но он будет отображаться с задержкой, чтобы не возникало конфликтных ситуаций.

## MVP
Для максимально сжатого MVP предлагается реализация только функции отметки неприятных пассажиров. Эта отметка будет держаться два дня для всех водителей и неделю для водителя, который её выставил.

Проверить предлагается как временные рамки, в которые видна отметка, так и целесообразность данного решения.

## Реализация

### Стек технологий
- Python
    + высокая скорость разработки
    + не предполагается высокая нагрузка
- PostgreSQL
    + фиксированная разметка данных
    + часть работы (например, расчет текущего рейтинга) можно при необходимости переложить на БД

### Архитектура
Фича достаточно небольшая и имеет смысл встроить её в систему оценивания водителей, но в качестве MVP лучше разработать отдельный микросервис.

### Взаимодействие
Участники взаимодействия:
- Клиент водителя
- Клиент пассажира
- Сервис оценок (Сервер)
- Оценки водителя (БД)

![db schema](https://github.com/YaBackSchool2021/homework1/blob/alexander-levandrovskiy/Levandrovskiy-Alex/db%20schema.png)

![sequence diagram](https://github.com/YaBackSchool2021/homework1/blob/alexander-levandrovskiy/Levandrovskiy-Alex/sequence%20diagram.png)

### Тестирование
Необходимо проведение Юнит тестов для проверки работоспособности приложения.

Интеграционное тестирование для подтверждения работоспособности приложения в инфраструктуре.

E2E тестирование для валидации поведения в инфраструктуре (в особенности важно в случае интеграции влияния рейтинга на подбор заказов).

Нагрузочное тестирование покажет отказоустойчивость приложения. Параметры нагрузки те же, что и у фичи оценивания водителя. Отображение до поездки и выставление после

### Внедрение и эксперимент
Включение и проверка в начале проводится командой. Необходимо проверить, верно ли отрабатывает отметка о неприятном пассажире, а так же правильность подсчёта рейтинга. Затем нужно переходить к постепенной выкатки фичи. В начале доступ к ней лучше выдавать водителям с большим стажем и высокими оценками. На данном этапе есть возможность провести AB тестирование, которое сможет показать, как часто водители будут ставить свои собственные оценки, как часто будут отказываться от заказа. Также необходимо будет опросить первую тестовую группу водителей на предмет полезности функции.
